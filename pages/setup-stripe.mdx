import { Callout } from "nextra-theme-docs";

# Setting Up Stripe

To integrate Stripe into your application, youâ€™ll need to configure some environment variables and set up the Customer Portal. Follow these steps to get everything set up.

## Table of Contents

- [Getting Stripe Keys](#getting-stripe-keys)
- [Setting Up the Customer Portal](#setting-up-the-customer-portal)

---

### **Getting Stripe Keys**

<Callout emoji="ðŸ“£">
  Before you proceed, ensure you have a Stripe account. If you don't, create one at [Stripe's website](https://stripe.com).
</Callout>

To start using Stripe, you need to obtain your API keys and configure them in your environment variables.

1. **Access Your Stripe Dashboard:**
   - Log in to your [Stripe Dashboard](https://dashboard.stripe.com/).


2. **Navigate to API Keys:**
   - In the left-hand menu, click on **Developers**.
   - Select **API keys**.


3. **Obtain Your Keys:**
   - **Publishable Key:** This key is used on the client-side of your application. Copy the key labeled **Publishable key**.
   - **Secret Key:** This key is used on the server-side of your application. Copy the key labeled **Secret key**.


4. **Add Keys to Your `.env` File:**
   - Open the `.env` file located in your projectâ€™s root directory.
   - Add the following lines to your `.env` file, replacing the placeholder text with your actual keys:

     ```env
     NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY={your_publishable_key_here}
     STRIPE_SECRET_KEY={your_secret_key_here}
     ```

   - Save the `.env` file after adding the keys.

   > **Note:** For local development, consider using the test keys available in your Stripe Dashboard under the "View test data" mode. Switch to live keys when deploying to production.

---

### **Setting Up the Customer Portal**

To allow users to manage their subscriptions and payment methods, you'll need to enable the Stripe Customer Portal. Follow these steps to set it up:

1. **Enable the Customer Portal:**
   - Go to [Stripe's Customer Portal settings](https://dashboard.stripe.com/settings/billing/portal) in your Stripe Dashboard.
   - In the Customer Portal settings page, locate the option to enable the portal. Click the toggle or button to enable it.

2. **Customize the Portal (Optional):**
   - Stripe provides options to customize the look and functionality of the portal. Adjust settings according to your needs, such as branding, language, and features available to users.

3. **Integrate the Portal into Your Application:**
   - Once the portal is enabled, users can access their Stripe account to manage subscriptions, payment methods, invoices, and more.
   - SaaSavant includes a pre-made user account page with a link that directs users to their Stripe portal. Ensure that this link is correctly integrated into your product by.


### **Stripe Webhook**

Now we need to setup a Stripe Webhook. The webhook is used to send notifications to your application when certain events occur in Stripe. This ensures that only paying users see certain content.

To do that, we'll go to the Stripe Dashboard, and click Developers > Webhooks.

Select the following events to send to that endpoint:

- product.created
- product.updated
- product.deleted
- price.created
- price.updated
- price.deleted
- checkout.session.completed
- customer.subscription.created
- customer.subscription.updated
- customer.subscription.deleted
- tax_rate.created (optional)
- tax_rate.updated (optional)
- invoice.paid (optional, will sync invoices to Cloud Firestore)
- invoice.payment_succeeded (optional, will sync invoices to Cloud Firestore)
- invoice.payment_failed (optional, will sync invoices to Cloud Firestore)
- invoice.upcoming (optional, will sync invoices to Cloud Firestore)
- invoice.marked_uncollectible (optional, will sync invoices to Cloud Firestore)
- invoice.payment_action_required (optional, will sync invoices to Cloud Firestore)

Once the webhook is complete, copy the signing secret and place it in the `.env.local` file of your project.
